echo "ğŸ” Running code validation..."

# # Check for Russian characters and non-Latin symbols in code files
# echo "ğŸ“ Checking for Russian characters and non-Latin symbols (deletions are ignored)..."

# # Find all TypeScript, JavaScript, JSX, TSX, JSON, and MDX files
# FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx|json|mdx)$' || true)

# if [ -n "$FILES" ]; then
#     # Check for Russian characters and non-Latin symbols
#     RUSSIAN_FOUND=false
    
#     for file in $FILES; do
#         # Skip node_modules and other build directories and localization files
#         if [[ "$file" == *"node_modules"* ]] || [[ "$file" == *".next"* ]] || [[ "$file" == *"dist"* ]] || [[ "$file" == *".husky"* ]] || [[ "$file" == *"src/messages/"* ]] ||
#          [[ "$file" == "packages/lib/transliteration.ts" ]] || 
#          [[ "$file" == "packages/components/misc/mdx-content.tsx" ]] ||
#             [[ "$file" == packages/content/locales/* ]] || [[ "$file" == packages/components/shared/mdx-content.tsx ]] || [[ "$file" == settings.ts ]] ; then
#             continue
#         fi
        
#         # Check for Russian characters (Ğ°-Ñ, Ğ-Ğ¯, Ñ‘, Ğ) - only in ADDED lines (ignore deletions)
#         if git diff --cached "$file" | grep '^+[^+]' | grep -q '[Ğ°-ÑÑ‘Ğ-Ğ¯Ğ]'; then
#             echo "âŒ Russian characters found in: $file"
#             echo "   Lines with Russian characters:"
#             git diff --cached "$file" | grep '^+[^+]' | grep -n '[Ğ°-ÑÑ‘Ğ-Ğ¯Ğ]' | head -5
#             RUSSIAN_FOUND=true
#         fi
        
#         # Check for other non-Latin symbols (except allowed ones) - only in ADDED lines (ignore deletions)
#         if git diff --cached "$file" | grep '^+[^+]' | grep -q '[^\x00-\x7FÂ©Â®â„¢â‚¬Â£Â¥Â¢Â§Â¶â€ â€¡â€¢â€£â‚â€»,.:;!?()[\]{}]'; then
#             echo "âŒ Non-Latin symbols found in: $file"
#             echo "   Lines with non-Latin symbols:"
#             git diff --cached "$file" | grep '^+[^+]' | grep -n '[^\x00-\x7FÂ©Â®â„¢â‚¬Â£Â¥Â¢Â§Â¶â€ â€¡â€¢â€£â‚â€»,.:;!?()[\]{}]' | head -5
#             RUSSIAN_FOUND=true
#         fi
#     done
    
#     if [ "$RUSSIAN_FOUND" = true ]; then
#         echo ""
#         echo "ğŸš« Commit blocked!"
#         echo "   Found Russian characters or non-Latin symbols in code files."
#         echo "   Please remove them and try again."
#         echo ""
#         echo "ğŸ’¡ Allowed symbols: Â©, Â®, â„¢, â‚¬, Â£, Â¥, Â¢, Â§, Â¶, â€ , â€¡, â€¢, â€£, â‚, â€»"
#         echo "   Code should be written in English only."
#         exit 1
#     fi
# fi

# # Check for Russian characters in comments and strings (warnings only)
# echo "âš ï¸  Checking comments and strings for Russian text (warnings only)..."

# for file in $FILES; do
#     if [[ "$file" == *"node_modules"* ]] || [[ "$file" == *".next"* ]] || [[ "$file" == *"dist"* ]] || [[ "$file" == *".husky"* ]] || [[ "$file" == *"src/messages/"* ]] || [[ "$file" == "src/lib/transliteration.ts" ]] || [[ "$file" == content/* ]]; then
#         continue
#     fi
    
#     # Check for Russian in comments (// and /* */) - only in ADDED lines (ignore deletions)
#     if git diff --cached "$file" | grep '^+[^+]' | grep -E '(//.*[Ğ°-ÑÑ‘Ğ-Ğ¯Ğ]|/\*.*[Ğ°-ÑÑ‘Ğ-Ğ¯Ğ])'; then
#         echo "âš ï¸  Warning: Russian text found in comments in: $file"
#     fi
    
#     # Check for Russian in strings (but allow in content files) - only in ADDED lines (ignore deletions)
#     if [[ "$file" != *"content/"* ]] && [[ "$file" != *"data/"* ]]; then
#         if git diff --cached "$file" | grep '^+[^+]' | grep -E '[^"]*[Ğ°-ÑÑ‘Ğ-Ğ¯Ğ][^"]*'; then
#             echo "âš ï¸  Warning: Russian text found in strings in: $file"
#         fi
#     fi
# done

# echo "ğŸ§ª Running quick e2e tests..."
# if ! bun run quick-test; then
#     echo "âŒ E2E quick tests failed. Aborting commit."
#     exit 1
# fi

# echo "ğŸ§ª Running integration tests..."
# if ! bun run test:integration; then
#     echo "âŒ Integration tests failed. Aborting commit."
#     exit 1
# fi

# echo "ğŸ§ª Running build cms..."
# if ! bun run build:cms; then
#     echo "âŒ Running build failed. Aborting commit."
#     exit 1
# fi

echo "ğŸ§ª Running type-check for site..."
if ! bun run type-check:site; then
    echo "âŒ Running build failed. Aborting commit."
    exit 1
fi

echo "âœ… Code validation passed!"
echo "ğŸš€ Proceeding with commit..."


